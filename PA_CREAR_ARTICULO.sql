USE [DAW]
GO

/****** Object:  StoredProcedure [dbo].[PA_CREAR_ARTICULO]    Script Date: 10/06/2022 14:44:50 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PA_CREAR_ARTICULO]
(  
 
 @DESCRIPCION VARCHAR(50),  
 @FABRICANTE VARCHAR(50),
 @PESO INT,  
 @LARGO INT,
 @ANCHO INT,  
 @ALTO INT,
 @PRECIO DECIMAL(10, 2), 
 @TALLA CHAR(1),
 @COLOR VARCHAR(50),
 @N_REGISTRO VARCHAR(50),
 @IMAGEN VARCHAR(100),
 @SEXO CHAR(1),

  
 @MENSAJE VARCHAR(100) OUTPUT,  
 @RETCODE INT OUTPUT,
 @ID_ARTICULO INT OUTPUT
)  
AS  
  
BEGIN TRY  
   

   SET @RETCODE = 0
   SET @MENSAJE = ''
  
 SET @ID_ARTICULO =  SCOPE_IDENTITY()

 SELECT @ID_ARTICULO = MAX(ID_ARTICULO) FROM ARTICULOS


/*Condicion para insertar unicamente datos de ropa si el articulo existe*/
IF EXISTS(SELECT DESCRIPCION FROM ARTICULOS WHERE @DESCRIPCION = DESCRIPCION)
 BEGIN
	 INSERT INTO ROPA 
 (
	ID_ARTICULO,
	TALLA,
	COLOR,
	IMAGEN
 )
 VALUES
 ( 
	@ID_ARTICULO,
	@TALLA,
	@COLOR,
	@IMAGEN
 )
 END 



 IF ISNULL(@N_REGISTRO,'') = ''  
 BEGIN  
  SET  @RETCODE = 10  
  SET @MENSAJE = 'El parametro n_registro no puede ser vac√≠o'  
  RETURN  
 END  

  
  
 INSERT INTO ARTICULOS  
 (  
	DESCRIPCION,
	FABRICANTE,
	PESO,
	LARGO,
	ANCHO,
	ALTO,
	PRECIO,
	N_REGISTRO,
	SEXO
 )  
 VALUES  
 (  
	@DESCRIPCION,
	@FABRICANTE,
	@PESO,
	@LARGO,
	@ANCHO,
	@ALTO,
	@PRECIO,
	@N_REGISTRO,
	@SEXO
	 
 )


  SET @ID_ARTICULO =  SCOPE_IDENTITY()

 SELECT @ID_ARTICULO = MAX(ID_ARTICULO) FROM ARTICULOS

 IF EXISTS(SELECT COLOR FROM ROPA WHERE @COLOR = COLOR)
 BEGIN
	 INSERT INTO ROPA 
 (
	ID_ARTICULO,
	TALLA,
	COLOR,
	IMAGEN
 )
 VALUES
 ( 
	@ID_ARTICULO,
	@TALLA,
	@COLOR,
	@IMAGEN
 )
 END 
 INSERT INTO ROPA 
 (
	ID_ARTICULO,
	TALLA,
	COLOR,
	IMAGEN
 )
 VALUES
 ( 
	@ID_ARTICULO,
	@TALLA,
	@COLOR,
	@IMAGEN
 )
 RETURN   
  
END TRY  
  
BEGIN CATCH  
  
END CATCH
GO

